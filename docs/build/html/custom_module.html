

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Working with modules &mdash; USP HPC 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon_2.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Getting Support" href="support.html" />
    <link rel="prev" title="Slurm" href="slurm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="client_configuration.html">Client configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_configuration.html">Server configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_gdrive.html">Install Google Drive</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tensorflow_settings.html">Tensorflow configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpucheck.html">GPU Health Check</a></li>
</ul>
<p class="caption"><span class="caption-text">SLURM</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="slurm.html">Slurm</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-custom-module">Create custom module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-the-module-path-to-modulepath">Add the module path to MODULEPATH</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Other Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Getting Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">USP HPC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Working with modules</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/custom_module.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="working-with-modules">
<h1>Working with modules<a class="headerlink" href="#working-with-modules" title="Permalink to this headline">¶</a></h1>
<p>Modules are a convenient way to manage environment variables for applications use. Unless you use the default installation of Anaconda available in HPC, you’ll need to modify custom modules. This section briefly explains how to work with modules and provides a custom module for Miniconda. See the references <a class="footnote-reference brackets" href="#ref" id="id1">1</a> to learn more about modules.</p>
<p>Environment modules set environment variables with specific values for each application. Run <strong>module avail</strong> to list all modules available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module avail

---------------------------------------------------------------- /opt/ohpc/pub/moduledeps/gnu7-openmpi3 ----------------------------------------------------------------
   adios/1.13.1        imb/2018.1     netcdf-cxx/4.3.0        phdf5/1.10.2        py2-scipy/1.1.0     scalasca/2.3.1    superlu_dist/5.3.0
   boost/1.67.0 (D)    mfem/3.3.2     netcdf-fortran/4.4.4    pnetcdf/1.9.0       py3-mpi4py/3.0.0    scorep/4.0        tau/2.27.1
   fftw/3.3.7          mpiP/3.4.1     netcdf/4.6.1            ptscotch/6.0.4      py3-scipy/1.1.0     sionlib/1.7.1     trilinos/12.12.1
   hypre/2.14.0        mumps/5.1.2    petsc/3.9.1             py2-mpi4py/3.0.0    scalapack/2.0.2     slepc/3.9.1

-------------------------------------------------------------------- /opt/ohpc/pub/moduledeps/gnu7 ---------------------------------------------------------------------
   R/3.5.0    hdf5/1.10.2    mpich/3.2.1    openblas/0.2.20    openmpi3/3.1.0 (L)    py2-numpy/1.14.3    superlu/5.2.1
   gsl/2.4    metis/5.1.0    ocr/1.0.1      openmpi/1.10.7     pdtoolkit/3.25        py3-numpy/1.14.3

---------------------------------------------------------------------- /opt/ohpc/pub/modulefiles -----------------------------------------------------------------------
   EasyBuild/3.8.1           clustershell/1.8    gnu7/7.3.0  (L)    intel/19.0.4.243        papi/5.6.0        singularity/3.1.0
   autotools          (L)    cmake/3.13.4        gnu8/8.3.0         llvm5/5.0.1             pmix/2.2.2        valgrind/3.14.0
   charliecloud/0.9.7        gnu/5.4.0           hwloc/2.0.3        ohpc             (L)    prun/1.3   (L)

-------------------------------------------------------------------------- /apps/modulefiles ---------------------------------------------------------------------------
   Anaconda/2-2019.03        Gromacs/5.1.4-cuda-mpi    Gromacs/2019.3-cuda (D)    amber/19-cpu        canal/1.5     lammps/7Aug19         mkl/2019.4.243
   Anaconda/3-2019.03 (D)    Gromacs/5.1.4-cuda        Gromacs/2019.3-mpi         amber/19-gpu        curves/3.0    lammps/29Oct20 (D)    ox/8.02-0-gnu
   Gromacs/4.0.7             Gromacs/5.1.4-mpi         NAMD/2.13-CUDA             amber/20-gpu (D)    dssp          magma/2.5.1           pgi/19.10
   Gromacs/4.6.7             Gromacs/2018.3-cuda       amber/18                   boost/1_71_0        g_mmpbsa      megacc/10.2.5         relion/3.1

--------------------------------------------------------------------------- /opt/modulefiles ---------------------------------------------------------------------------
   cuda/8.0    cuda/10.0    cuda/10.1 (L,D)


  Where:
   D:  Default Module
   L:  Module is loaded

Use &quot;module spider&quot; to find all possible modules.
Use &quot;module keyword key1 key2 ...&quot; to search for all possible modules matching any of the &quot;keys&quot;.
</pre></div>
</div>
<p>You can load a module with <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module load Anaconda/3-2019.03
</pre></div>
</div>
<div class="section" id="create-custom-module">
<h2>Create custom module<a class="headerlink" href="#create-custom-module" title="Permalink to this headline">¶</a></h2>
<p>You can create custom modules to modify the environment variables. The custom module presented here is a copy of <strong>lince</strong>’s <code class="docutils literal notranslate"><span class="pre">Anaconda/3-2019</span></code> module modified for Miniconda.</p>
<p>Custom modules are saved in the <code class="docutils literal notranslate"><span class="pre">modulefiles</span></code> folder. The folder structure is <code class="docutils literal notranslate"><span class="pre">modulefiles/&lt;app_name&gt;/&lt;version&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;app_name&gt;</span></code> is the application name and <code class="docutils literal notranslate"><span class="pre">&lt;version&gt;</span></code> is the module version. Actually, it may be any name but we use this convention for simplicity.</p>
<blockquote>
<div><p>$ mkdir -p ~/modulefiles/Miniconda/</p>
</div></blockquote>
<p>Now, use a text editor such as <code class="docutils literal notranslate"><span class="pre">vim</span></code> or <code class="docutils literal notranslate"><span class="pre">nano</span></code> to create the file <code class="docutils literal notranslate"><span class="pre">1.0</span></code> with the following content.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ~/modulefiles/Miniconda
# use a text editor to create the module file called 1.0 (which is the version)
$ cat 1.0
#%Module#######################################

set INSTALL_DIR /scratch/&lt;YOUR_NUSP&gt;/miniconda3

conflict pyhton  anaconda  Anaconda miniconda Miniconda

prepend-path PATH ${INSTALL_DIR}/bin
prepend-path INCLUDE ${INSTALL_DIR}/include/
prepend-path -d  &quot; &quot; CPPFLAGS   -I${INSTALL_DIR}/include
prepend-path -d &quot; &quot; LDFLAGS -L${INSTALL_DIR}/lib
prepend-path LD_LIBRARY_PATH ${INSTALL_DIR}/lib
prepend-path MANPATH ${INSTALL_DIR}/share/man
</pre></div>
</div>
<p>Where YOUR_NUSP is your user id.</p>
</div>
<div class="section" id="add-the-module-path-to-modulepath">
<h2>Add the module path to MODULEPATH<a class="headerlink" href="#add-the-module-path-to-modulepath" title="Permalink to this headline">¶</a></h2>
<p>Now that the module file has been created, one just needs to add the following line to your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file so that it will be found:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">use</span> <span class="o">--</span><span class="n">append</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="mi">11568881</span><span class="o">/</span><span class="n">modulefiles</span><span class="o">/</span>
</pre></div>
</div>
<p>The next time you log in you will be able to run <strong>module avail</strong> or <strong>module load</strong> on the new module.</p>
<p>You also need to add these lines in your SLURM schedule script to load the environment variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">use</span> <span class="o">--</span><span class="n">append</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="mi">11568881</span><span class="o">/</span><span class="n">modulefiles</span><span class="o">/</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">Miniconda</span><span class="o">/</span><span class="mf">1.0</span>
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="ref"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>References:</p>
</dd>
</dl>
<p><a class="reference external" href="https://researchcomputing.princeton.edu/support/knowledge-base/modules">https://researchcomputing.princeton.edu/support/knowledge-base/modules</a></p>
<p><a class="reference external" href="https://researchcomputing.princeton.edu/support/knowledge-base/custom-modules">https://researchcomputing.princeton.edu/support/knowledge-base/custom-modules</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="support.html" class="btn btn-neutral float-right" title="Getting Support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="slurm.html" class="btn btn-neutral float-left" title="Slurm" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Victor Ivamoto.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>